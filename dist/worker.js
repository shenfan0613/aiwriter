!function(e){var t={};function a(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=t,a.d=function(e,t,r){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(a.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)a.d(r,n,function(t){return e[t]}.bind(null,n));return r},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=0)}([function(e,t){console.log(AIRTABLE_API_KEY);addEventListener("fetch",e=>{e.respondWith(async function(e){if("/submit"===new URL(e.url).pathname)return a(e);return Response.redirect("https://aiwriter.pages.dev/")}(e.request))});const a=async e=>{if("POST"!==e.method)return new Response("Method Not Allowed",{status:405});const t=await e.formData(),a=(await e.headers).get("x-real-ip");let n;const{userId:u,jobType:c,requestType:l,fieldId:p}=Object.fromEntries(t);console.log(Object.fromEntries(t));const f={fields:{userIP:a,userId:u,usage:0}};let I=0,b=await async function({userId:e}){let t=await fetch("https://api.airtable.com/v0/appNzuUysRFnMK56E/user",{method:"GET",headers:{Authorization:"Bearer "+AIRTABLE_API_KEY,"Content-type":"application/json"}}),a=(await t.json()).records,r=!1;for(const t of a)t.fields.userId===e&&(r=!0);return r}({userId:u}),y=+new Date-await async function({userIP:e}){let t=await fetch("https://api.airtable.com/v0/appNzuUysRFnMK56E/user",{method:"GET",headers:{Authorization:"Bearer "+AIRTABLE_API_KEY,"Content-type":"application/json"}}),a=(await t.json()).records,r=0;for(const t of a)t.fields.userIP===e&&r<Date.parse(t.fields.lastUpdate)&&(r=Date.parse(t.fields.lastUpdate));return r}({userIP:a});if(y>=1500&&await async function({userIP:e}){let t=await fetch("https://api.airtable.com/v0/appNzuUysRFnMK56E/user",{method:"GET",headers:{Authorization:"Bearer "+AIRTABLE_API_KEY,"Content-type":"application/json"}}),a=(await t.json()).records;for(const t of a)if(t.fields.userIP===e){t.id;let e=t.fields.userId;await o({userId:e,usage:0})}return t}({userIP:a}),b?(I=await r({userIP:a}),console.log(I)):await s({body:f,tableName:"user"}),console.log("time since last update "+y),!(I<2))return Response.redirect("https://aiwriter.pages.dev/fail");if("jobDescription"===l)n="60586b31cdebbb000c21058d",await d({userId:u,jobTitle:c,ryteId:n});else if("interviewQuestion"===l){n="6058693ccdebbb000c210588";let e=await d({userId:u,jobTitle:c,ryteId:n});console.log(await async function({userId:e,text:t}){let a={personalizations:[{to:[{email:""+e}]}],from:{email:"shenfansj@gmail.com"},subject:"Interview Question Samples",content:[{type:"text/plain",value:""+t}]};return console.log(JSON.stringify(a)),await fetch("https://api.sendgrid.com/v3/mail/send",{method:"POST",headers:{Authorization:"Bearer "+SENDGRID_API_KEY,"Content-Type":"application/json"},body:JSON.stringify(a)})}({userId:u,text:e})),await async function({userId:e,fieldId:t}){let a={records:[{id:t,fields:{userId:e}}]};return console.log("patch body:"+JSON.stringify(a)),i({body:a,tableName:"paragragh"})}({userId:u,fieldId:p})}return Response.redirect("https://aiwriter.pages.dev/result")};async function r({userIP:e}){let t=await fetch("https://api.airtable.com/v0/appNzuUysRFnMK56E/user",{method:"GET",headers:{Authorization:"Bearer "+AIRTABLE_API_KEY,"Content-type":"application/json"}}),a=(await t.json()).records,r=0;for(const t of a)t.fields.userIP===e&&(r+=t.fields.usage);return r}async function n({userId:e}){let t,a=await fetch("https://api.airtable.com/v0/appNzuUysRFnMK56E/user",{method:"GET",headers:{Authorization:"Bearer "+AIRTABLE_API_KEY,"Content-type":"application/json"}}),r=(await a.json()).records;for(const a of r)a.fields.userId===e&&(t=a.id);return t}async function o({userId:e,usage:t}){let a={records:[{id:await n({userId:e}),fields:{userId:e,usage:t}}]};return console.log("set user "+e+" usage to "+t),await i({body:a,tableName:"user"})}async function s({body:e,tableName:t}){return fetch(`https://api.airtable.com/v0/${AIRTABLE_BASE_ID}/${encodeURIComponent(t)}`,{method:"POST",body:JSON.stringify(e),headers:{Authorization:"Bearer "+AIRTABLE_API_KEY,"Content-type":"application/json"}})}async function i({body:e,tableName:t}){return fetch(`https://api.airtable.com/v0/${AIRTABLE_BASE_ID}/${encodeURIComponent(t)}`,{method:"PATCH",body:JSON.stringify(e),headers:{Authorization:"Bearer "+AIRTABLE_API_KEY,"Content-type":"application/json"}})}async function d({userId:e,jobTitle:t,ryteId:a}){let r;r="60586b31cdebbb000c21058d"===a?{JOB_ROLE_LABEL:t}:{INTERVIEWEE_BIO_LABEL:"John Doe is a person",INTERVIEW_CONTEXT_LABEL:"Interviewing a candidate for the role of "+t};const n={languageId:"607adac76f8fe5000c1e636d",toneId:"60572a639bdd4272b8fe358b",useCaseId:a,inputContexts:r,variations:1,userId:e,format:"text"};console.log(JSON.stringify(n));let o=await fetch("https://api.rytr.me/v1/ryte",{method:"POST",headers:{Authentication:"Bearer "+RYTE_API_KEY,"Content-type":"application/json"},body:JSON.stringify(n)}),i=await o.json();console.log(i.data[0].text);const d={fields:{userId:e,content:i.data[0].text,jobType:t}};return"60586b31cdebbb000c21058d"===a?await s({body:d,tableName:"paragragh"}):"6058693ccdebbb000c210588"===a&&await s({body:d,tableName:"interview"}),i.data[0].text}}]);