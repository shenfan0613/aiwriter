{"code":"!function(e){var t={};function n(a){if(t[a])return t[a].exports;var r=t[a]={i:a,l:!1,exports:{}};return e[a].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&\"object\"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,\"default\",{enumerable:!0,value:e}),2&t&&\"string\"!=typeof e)for(var r in e)n.d(a,r,function(t){return e[t]}.bind(null,r));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,\"a\",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p=\"\",n(n.s=0)}([function(e,t){addEventListener(\"fetch\",e=>{e.respondWith(async function(e){if(\"/submit\"===new URL(e.url).pathname)return n(e);return Response.redirect(\"https://aiwriter.pages.dev/\")}(e.request))});const n=async e=>{if(\"POST\"!==e.method)return new Response(\"Method Not Allowed\",{status:405});const t=await e.formData(),n=(await e.headers).get(\"x-real-ip\"),{userId:r,jobType:i}=Object.fromEntries(t);console.log(t.userId);const u={fields:{userIP:n,userId:r,usage:0}};let c=0,d=await async function({userId:e}){let t=await fetch(\"https://api.airtable.com/v0/appNzuUysRFnMK56E/user\",{method:\"GET\",headers:{Authorization:\"Bearer keyVDFnHwMynxFqLv\",\"Content-type\":\"application/json\"}}),n=(await t.json()).records,a=!1;for(const t of n)t.fields.userId===e&&(a=!0);return a}({userId:r}),p=+new Date-await async function({userIP:e}){let t=await fetch(\"https://api.airtable.com/v0/appNzuUysRFnMK56E/user\",{method:\"GET\",headers:{Authorization:\"Bearer keyVDFnHwMynxFqLv\",\"Content-type\":\"application/json\"}}),n=(await t.json()).records,a=0;for(const t of n)t.fields.userIP===e&&a<Date.parse(t.fields.lastUpdate)&&(a=Date.parse(t.fields.lastUpdate));return a}({userIP:n});return p>=1500&&await async function({userIP:e}){let t=await fetch(\"https://api.airtable.com/v0/appNzuUysRFnMK56E/user\",{method:\"GET\",headers:{Authorization:\"Bearer keyVDFnHwMynxFqLv\",\"Content-type\":\"application/json\"}}),n=(await t.json()).records;for(const t of n)if(t.fields.userIP===e){t.id;let e=t.fields.userId;await o({userId:e,usage:0})}return t}({userIP:n}),d?(c=await a({userIP:n}),console.log(c)):await s({body:u,tableName:\"user\"}),console.log(\"time since last update \"+p),c<2?(await async function(){return await fetch(\"https://api.sendgrid.com/v3/mail/send\",{method:\"POST\",headers:{Authorization:\"Bearer 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\",\"Content-Type\":\"application/json\"},body:JSON.stringify({personalizations:[{to:[{email:\"shenfansj@gmail.com\"}]}],from:{email:\"shenfansj@gmail.com\"},subject:\"Sending with SendGrid is Fun\",content:[{type:\"text/plain\",value:\"and easy to do anywhere, even with cURL\"}]})})}(),Response.redirect(\"https://aiwriter.pages.dev/result\")):Response.redirect(\"https://aiwriter.pages.dev/fail\")};async function a({userIP:e}){let t=await fetch(\"https://api.airtable.com/v0/appNzuUysRFnMK56E/user\",{method:\"GET\",headers:{Authorization:\"Bearer keyVDFnHwMynxFqLv\",\"Content-type\":\"application/json\"}}),n=(await t.json()).records,a=0;for(const t of n)t.fields.userIP===e&&(a+=t.fields.usage);return a}async function r({userId:e}){let t,n=await fetch(\"https://api.airtable.com/v0/appNzuUysRFnMK56E/user\",{method:\"GET\",headers:{Authorization:\"Bearer keyVDFnHwMynxFqLv\",\"Content-type\":\"application/json\"}}),a=(await n.json()).records;for(const n of a)n.fields.userId===e&&(t=n.id);return t}async function o({userId:e,usage:t}){let n={records:[{id:await r({userId:e}),fields:{userId:e,usage:t}}]};return console.log(\"set user \"+e+\" usage to \"+t),await i({body:n,tableName:\"user\"})}async function s({body:e,tableName:t}){return fetch(\"https://api.airtable.com/v0/appNzuUysRFnMK56E/\"+encodeURIComponent(t),{method:\"POST\",body:JSON.stringify(e),headers:{Authorization:\"Bearer keyVDFnHwMynxFqLv\",\"Content-type\":\"application/json\"}})}async function i({body:e,tableName:t}){return fetch(\"https://api.airtable.com/v0/appNzuUysRFnMK56E/\"+encodeURIComponent(t),{method:\"PATCH\",body:JSON.stringify(e),headers:{Authorization:\"Bearer keyVDFnHwMynxFqLv\",\"Content-type\":\"application/json\"}})}}]);","extractedComments":[]}